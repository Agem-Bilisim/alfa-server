<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorator="layouts/dashboard">
<head>
	<title>Donanım Envanteri</title>
	<!-- DataTables -->
	<link th:href="@{/plugins/DataTables/datatables.min.css}" rel="stylesheet" />
</head>
<body>
	<th:block layout:fragment="breadcrumb-list">
		<li class="active">Donanım Envanteri</li>
	</th:block>

	<div layout:fragment="content">
		<div class="row">
			<div class="col-xs-12">
				<!-- Nav tabs -->
				<ul class="nav nav-tabs" role="tablist">
					<li role="presentation" class="active"><a href="#cpu" aria-controls="cpu" role="tab" data-toggle="tab">İşlemci</a></li>
			    	<li role="presentation"><a href="#gpu" aria-controls="gpu" role="tab" data-toggle="tab">Grafik kart</a></li>
			    	<li role="presentation"><a href="#disk" aria-controls="disk" role="tab" data-toggle="tab">Disk</a></li>
			    	<li role="presentation"><a href="#memory" aria-controls="memory" role="tab" data-toggle="tab">RAM Bellek</a></li>
			    	<li role="presentation"><a href="#bios" aria-controls="bios" role="tab" data-toggle="tab">BIOS</a></li>
			    	<li role="presentation"><a href="#networkInterface" aria-controls="networkInterface" role="tab" data-toggle="tab">Ağ</a></li>
			    	<li role="presentation"><a href="#problem" aria-controls="problem" role="tab" data-toggle="tab">Sorunlar</a></li>
			    	<li role="presentation"><a href="#compatibleHardware" aria-controls="compatibleHardware" role="tab" data-toggle="tab">Uyumlu Donanımlar</a></li>
			  	</ul>
			
				<!-- Tab panes -->
				<div class="tab-content">
					<div role="tabpanel" class="tab-pane active" id="cpu">
						<div class="box">
							<div class="box-header">
								<h3 class="box-title">İşlemci listesi</h3>
							</div>
							<div class="box-body">
								<table id="cpuTable" class="table table-bordered table-striped">
									<thead>
										<tr>
											<th>Marka</th>
											<th>Model</th>
											<th>Çekirdek Sayısı</th>
											<th>Hız (Hz)</th>
											<th>Üretici Firma</th>
											<th>Mimari</th>
											<th>İşlemler</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>
						</div>
					</div>
					<div role="tabpanel" class="tab-pane" id="gpu">
						<div class="box">
							<div class="box-header">
								<h3 class="box-title">Ekran Kartı listesi</h3>
							</div>
							<div class="box-body">
								<table id="gpuTable" class="table table-bordered table-striped">
									<thead>
										<tr>
											<th>Altsistem</th>
											<th>Bellek</th>
											<th>Kernel</th>
											<th>İşlemler</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>
						</div>
					</div>
					<div role="tabpanel" class="tab-pane" id="disk">
						<div class="box">
							<div class="box-header">
								<h3 class="box-title">Disk listesi</h3>
							</div>
							<div class="box-body">
								<table id="diskTable" class="table table-bordered table-striped">
									<thead>
										<tr>
											<th>Marka</th>
											<th>Açıklama</th>
											<th>Versiyon</th>
											<th>Ürün</th>
											<th>Serial</th>
											<th>İşlemler</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>
						</div>
					</div>
					<div role="tabpanel" class="tab-pane" id="memory">
						<div class="box">
							<div class="box-header">
								<h3 class="box-title">Bellek listesi</h3>
							</div>
							<div class="box-body">
								<table id="memoryTable" class="table table-bordered table-striped">
									<thead>
										<tr>
											<th>Marka</th>
											<th>Hız</th>
											<th>Boyut</th>
											<th>Tip</th>
											<th>İşlemler</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>
						</div>
					</div>
					<div role="tabpanel" class="tab-pane" id="bios">
						<div class="box">
							<div class="box-header">
								<h3 class="box-title">BIOS listesi</h3>
							</div>
							<div class="box-body">
								<table id="biosTable" class="table table-bordered table-striped">
									<thead>
										<tr>
											<th>Marka</th>
											<th>Versiyon</th>
											<th>Çıkış Tarihi</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>
						</div>
					</div>
					<div role="tabpanel" class="tab-pane" id="networkInterface">
						<div class="box">
							<div class="box-header">
								<h3 class="box-title">Ethernet Listesi</h3>
							</div>
							<div class="box-body">
								<table id="networkInterfaceTable" class="table table-bordered table-striped">
									<thead>
										<tr>
											<th>Marka</th>
											<th>Versiyon</th>
											<th>Ürün</th>
											<th>Yetenekler</th>
											<th>İşlemler</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>
						</div>
					</div>
					<div role="tabpanel" class="tab-pane" id="problem">
						<div class="box">
							<div class="box-header">
								<h3 class="box-title">Donanım kaynaklı sorunlar</h3>
							</div>
							<div class="box-body">
								<table id="problemTable" class="table table-bordered table-striped">
									<thead>
										<tr>
											<th>Kısa Tanım</th>
											<th>Açıklama</th>
											<th>Durum</th>
											<th>İşlem</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>
						</div>
					</div>
					<div role="tabpanel" class="tab-pane" id="compatibleHardware">
						<div class="box">
							<div class="box-header">
								<h3 class="box-title">Uyumlu Donanım Listesi</h3>
							</div>
							<div class="box-body">
								<table id="compatibleHardwareTable" class="table table-bordered table-striped">
									<thead>
										<tr>
											<th>Ürün</th>
											<th>Marka</th>
											<th>Versiyon</th>
											<th>Tür</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div
			layout:insert="layouts/default-modal :: modal(modalId='deleteConfirmModal', modalHeader='Kayıt silinecek?', modalButton='Devam')"
			th:remove="tag">
			<p layout:fragment="modal-content">Seçili kayıt silinmek üzere. Devam etmek istiyor musunuz?</p>
		</div>
		
		<!-- Process Selection Modal -->
		<div layout:insert="layouts/default-modal :: modal(modalId='processSelectModal', modalHeader='Süreç Başlat', modalButton='Başlat')"
			th:remove="tag">
			<div layout:fragment="modal-content" class="form-group">
				<select class="form-control" id="bpmProcess" name="bpmProcess" style="width: 100%;">
					<option th:each="process : ${processes}" th:text="${process.name + ' [' + process.version + ']'}" th:value="${process.id}"></option>
				</select>
			</div>
		</div>		
	</div>
	<!-- Delete confirmation modal -->
	<script layout:fragment="custom-script" th:inline="javascript">
	
		var startProcess = function(id) {
			$("#processSelectModalBtn").on("click", function(){
				$('#processSelectModal').modal('hide');
				window.location.href = "/alfa/bpm-task/startForm/" + $("#bpmProcess").val() + "?relatedComponent=Sorun&relatedComponentId="+id + "&redirect=hardware%2Flist";
			});
			
			$('#processSelectModal').modal('show');
		};
	
		var tables = {};
		var handleDelete = function(url, tableToRefresh) {
			$("#deleteConfirmModalBtn").on("click", function(){
				$('#deleteConfirmModal').modal('hide');
				$.ajax({
					type : "POST",
					contentType : "application/json",
					url : url,
					dataType : 'json',
					cache : false,
					timeout : 600000,
					beforeSend: function(xhr) {
						var token = $('#_csrf').attr('content');
						var header = $('#_csrf_header').attr('content');
						xhr.setRequestHeader(header, token);
					},
					success : function(result) {
						alertify.success('Kayıt silindi.');
						if (tables[tableToRefresh]) tables[tableToRefresh].ajax.reload();
					}
				});
			});
			$('#deleteConfirmModal').modal('show');
		};
		$(function() {
			// CPU
			var fnActionBtnsCpu = function(row, type, val, meta) {
				return "<div class=\"btn-group\" role=\"group\">" 
					+ "<a class=\"btn btn-outline-primary\" href=\"/alfa/hardware/cpu/" + row["id"] + "\"><i class=\"fa fa-edit\"></i></a>"
					+ "<button class=\"btn btn-outline-danger\" onclick=\"handleDelete('/alfa/hardware/cpu/" + row['id'] + "/delete', 'cpuTable')\"><i class=\"fa fa-trash\"></i></button>" 
					+ "</div>";
			};
			var drawCallbackCpu = function(settings) {
				if ($("#newCpuBtn").length == 0) {
					$("#cpuTable_filter").append("<button type=\"button\" class=\"btn btn-info\" id=\"newCpuBtn\">Yeni</button>");
					$("#newCpuBtn").on("click", function() {
						window.location.href = '/alfa/hardware/cpu/create?redirect=hardware/list';
					});
				}
			};
			const colsCpu = [
				{"data": "brand", "searchable": true, "orderable": true }, 
				{"data": "model", "searchable": true, "orderable": true }, 
				{"data": "pyhsicalCoreCount", "searchable": true, "orderable": true }, 
				{"data": "hzAdvertised", "searchable": true, "orderable": true }, 
				{"data": "vendorId", "searchable": true, "orderable": true }, 
				{"data": "arch", "searchable": true, "orderable": true }, 
				{"data": fnActionBtnsCpu, "searchable": false, "orderable": false }
			];
			tables.cpuTable = $('#cpuTable').paginatedTable("/alfa/hardware/cpu/list-paginated", "cpus", colsCpu, drawCallbackCpu);

			// GPU
			var fnActionBtnsGpu = function(row, type, val, meta) {
				return "<div class=\"btn-group\" role=\"group\">" 
					+ "<a class=\"btn btn-outline-primary\" href=\"/alfa/hardware/gpu/" + row["id"] + "\"><i class=\"fa fa-edit\"></i></a>"
					+ "<button class=\"btn btn-outline-danger\" onclick=\"handleDelete('/alfa/hardware/gpu/" + row['id'] + "/delete', 'gpuTable')\"><i class=\"fa fa-trash\"></i></button>" 
					+ "</div>";
			};
			var drawCallbackGpu = function(settings) {
				if ($("#newGpuBtn").length == 0) {
					$("#gpuTable_filter").append("<button type=\"button\" class=\"btn btn-info\" id=\"newGpuBtn\">Yeni</button>");
					$("#newGpuBtn").on("click", function() {
						window.location.href = '/alfa/hardware/gpu/create?redirect=hardware/list';
					});
				}
			};
			const colsGpu = [
				{"data": "subsystem", "searchable": true, "orderable": true }, 
				{"data": "kernel", "searchable": true, "orderable": true }, 
				{"data": "memory", "searchable": true, "orderable": true }, 
				{"data": fnActionBtnsGpu, "searchable": false, "orderable": false }
			];
			
			// Disk
			var fnActionBtnsDisk = function(row, type, val, meta) {
				return "<div class=\"btn-group\" role=\"group\">" 
					+ "<a class=\"btn btn-outline-primary\" href=\"/alfa/hardware/disk/" + row["id"] + "\"><i class=\"fa fa-edit\"></i></a>"
					+ "<button class=\"btn btn-outline-danger\" onclick=\"handleDelete('/alfa/hardware/disk/" + row['id'] + "/delete', 'diskTable')\"><i class=\"fa fa-trash\"></i></button>" 
					+ "</div>";
			};
			var drawCallbackDisk = function(settings) {
				if ($("#newDiskBtn").length == 0) {
					$("#diskTable_filter").append("<button type=\"button\" class=\"btn btn-info\" id=\"newDiskBtn\">Yeni</button>");
					$("#newDiskBtn").on("click", function() {
						window.location.href = '/alfa/hardware/disk/create?redirect=hardware/list';
					});
				}
			};
			const colsDisk = [
				{"data": "vendor", "searchable": true, "orderable": true }, 
				{"data": "description", "searchable": true, "orderable": true }, 
				{"data": "version", "searchable": true, "orderable": true }, 
				{"data": "product", "searchable": true, "orderable": true }, 
				{"data": "serial", "searchable": true, "orderable": true }, 
				{"data": fnActionBtnsDisk, "searchable": false, "orderable": false }
			];

			// Memory
			var fnActionBtnsMemory = function(row, type, val, meta) {
				return "<div class=\"btn-group\" role=\"group\">" 
					+ "<a class=\"btn btn-outline-primary\" href=\"/alfa/hardware/memory/" + row["id"] + "\"><i class=\"fa fa-edit\"></i></a>"
					+ "<button class=\"btn btn-outline-danger\" onclick=\"handleDelete('/alfa/hardware/memory/" + row['id'] + "/delete', 'memoryTable')\"><i class=\"fa fa-trash\"></i></button>" 
					+ "</div>";
			};
			var drawCallbackMemory = function(settings) {
				if ($("#newMemoryBtn").length == 0) {
					$("#memoryTable_filter").append("<button type=\"button\" class=\"btn btn-info\" id=\"newMemoryBtn\">Yeni</button>");
					$("#newMemoryBtn").on("click", function() {
						window.location.href = '/alfa/hardware/memory/create?redirect=hardware/list';
					});
				}
			};
			const colsMemory = [
				{"data": "manufacturer", "searchable": true, "orderable": true }, 
				{"data": "speed", "searchable": true, "orderable": true }, 
				{"data": "size", "searchable": true, "orderable": true }, 
				{"data": "type", "searchable": true, "orderable": true }, 
				{"data": fnActionBtnsMemory, "searchable": false, "orderable": false }
			];

			// BIOS
			var drawCallbackBios = function(settings) {
				if ($("#newBiosBtn").length == 0) {
					$("#biosTable_filter").append("<button type=\"button\" class=\"btn btn-info\" id=\"newBiosBtn\">Yeni</button>");
					$("#newBiosBtn").on("click", function() {
						window.location.href = '/alfa/hardware/bios/create?redirect=hardware/list';
					});
				}
			};
			const colsBios = [
				{"data": "vendor", "searchable": true, "orderable": true }, 
				{"data": "version", "searchable": true, "orderable": true }, 
				{"data": "releaseDate", "searchable": true, "orderable": true }
			];

			// NetworkInterface
			var fnActionBtnsNetworkInterface = function(row, type, val, meta) {
				return "<div class=\"btn-group\" role=\"group\">" 
					+ "<a class=\"btn btn-outline-primary\" href=\"/alfa/hardware/networkInterface/" + row["id"] + "\"><i class=\"fa fa-edit\"></i></a>"
					+ "<button class=\"btn btn-outline-danger\" onclick=\"handleDelete('/alfa/hardware/networkInterface/" + row['id'] + "/delete', 'networkInterfaceTable')\"><i class=\"fa fa-trash\"></i></button>" 
					+ "</div>";
			};
			var drawCallbackNetworkInterface = function(settings) {
				if ($("#newNetworkInterfaceBtn").length == 0) {
					$("#networkInterfaceTable_filter").append("<button type=\"button\" class=\"btn btn-info\" id=\"newNetworkInterfaceBtn\">Yeni</button>");
					$("#newNetworkInterfaceBtn").on("click", function() {
						window.location.href = '/alfa/hardware/networkInterface/create?redirect=hardware/list';
					});
				}
			};
			const colsNetworkInterface = [
				{"data": "vendor", "searchable": true, "orderable": true }, 
				{"data": "version", "searchable": true, "orderable": true }, 
				{"data": "product", "searchable": true, "orderable": true }, 
				{"data": "capabilities", "searchable": true, "orderable": true }, 
				{"data": fnActionBtnsNetworkInterface, "searchable": false, "orderable": false }
			];
			
			// Problem
			var fnActionBtnsProblem = function(row, type, val, meta) {
				return "<div class=\"btn-group\" role=\"group\">" 
				+ "<a class=\"btn btn-outline-primary\" href=\"/alfa/problem/" + row["id"] + "?referenceTypes[]=6,8&redirect=hardware/list\"><i class=\"fa fa-edit\"></i> Düzenle</a>"
				+ "<button class=\"btn btn-outline-danger\" onclick=\"handleDelete('/alfa/problem/" + row['id'] + "/delete', 'problemTable')\"><i class=\"fa fa-trash\"></i> Sil</button>"
				+ "<button class=\"btn btn-outline-dark\" onclick=\"startProcess("+ row['id']+")\"><i class=\"fa fa-play\"></i> Süreç Başlat</button>"				
				+ "</div>";
			};
			var drawCallbackProblem = function(settings) {
				if ($("#newProblemBtn").length == 0) {
					$("#problemTable_filter").append("<button type=\"button\" class=\"btn btn-info\" id=\"newProblemBtn\">Yeni</button>");
					$("#newProblemBtn").on("click", function() {
						window.location.href = '/alfa/problem/create?referenceTypes[]=6,8&redirect=hardware/list';
					});
				}
			};
			const colsProblem = [
				{"data": "label", "searchable": true, "orderable": true }, 
				{"data": "description", "searchable": true, "orderable": true }, 
				{"data": 
					function ( row, type, val, meta ) { 
						row["solved_str"] = (row["solved"] == true ? "Çözüldü" : "Devam ediyor"); 
						return row["solved_str"]; 
					}
				, "searchable": true, "orderable": true }, 
				{"data": fnActionBtnsProblem, "searchable": false, "orderable": false }
			];

			// Compatible Hardware
			var drawCallbackCompatibleHardware = function(settings) {
			};
			const colsCompatibleHardware = [
				{"data": "name", "searchable": false, "orderable": false }, 
				{"data": "product", "searchable": false, "orderable": false }, 
				{"data": "version", "searchable": false, "orderable": false }, 
				{"data": "type", "searchable": false, "orderable": false } 
			];

			
			// Handle table init
			$('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
				if ($(e.target).attr('href') == "#gpu") {
					tables.gpuTable = $('#gpuTable').paginatedTable("/alfa/hardware/gpu/list-paginated", "gpus", colsGpu, drawCallbackGpu);
				} else if ($(e.target).attr('href') == "#disk") {
					tables.diskTable = $('#diskTable').paginatedTable("/alfa/hardware/disk/list-paginated", "disks", colsDisk, drawCallbackDisk);			
				} else if ($(e.target).attr('href') == "#memory") {
					tables.memoryTable = $('#memoryTable').paginatedTable("/alfa/hardware/memory/list-paginated", "memories", colsMemory, drawCallbackMemory);			
				} else if ($(e.target).attr('href') == "#bios") {
					tables.biosTable = $('#biosTable').paginatedTable("/alfa/hardware/bios/list-paginated", "bioss", colsBios, drawCallbackBios);			
				} else if ($(e.target).attr('href') == "#networkInterface") {
					tables.networkInterfaceTable = $('#networkInterfaceTable').paginatedTable("/alfa/hardware/networkInterface/list-paginated", "networkInterfaces", colsNetworkInterface, drawCallbackNetworkInterface);			
				} else if ($(e.target).attr('href') == "#problem") {
					tables.problemTable = $('#problemTable').paginatedTable("/alfa/problem/list-paginated?referenceTypes[]=6,8", "problems", colsProblem, drawCallbackProblem);
				} else if ($(e.target).attr('href') == "#compatibleHardware") {
					tables.compatibleHardwareTable = $('#compatibleHardwareTable').paginatedTable("/alfa/hardware/hardware-compatible/list-paginated?compatible=E", "compatibleHardwares", colsCompatibleHardware, drawCallbackCompatibleHardware);
				}
			});
		});
		
	</script>
</body>
</html>
